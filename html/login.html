<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link rel="stylesheet" href="../css/login-style.css">
</head>

<body>
    <div id="loginPage" class="container">
        <!-- âœ… Added id="loginForm" so JS can bind properly -->
        <form id="loginForm" class="form-group">
            <div class=" bg p-4">
                <button type="button" class="btn-close btn-close-white" aria-label="Close"
                    onclick="history.back();"></button>

                <h2 class="text-center mb-3">Log in</h2>
                <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="floatingEmail" placeholder="name@ligaya.gensan.com"
                        required name="email">
                    <label for="floatingEmail">Email</label>
                </div>
                <div class="form-floating">
                    <input type="password" class="form-control" id="floatingPassword" placeholder="Password"
                        name="password" required>
                    <label for="floatingPassword">Password</label>
                </div>
                <div class="forgot-pass">
                    <a href="../html/change_pass.html">forgot password</a>
                </div>
                <button class="btn btn-login" type="submit">Login</button>
                <div class="register-link">
                    <p>Don't have an account?</p>
                    <a href="../html/signup.html">Register</a>
                </div>
            </div>
        </form>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- âœ… Moved script inside body for safe DOM access -->
    <script>
        document.getElementById("loginForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const email = document.getElementById("floatingEmail").value;
    const password = document.getElementById("floatingPassword").value;

    fetch("../php-handlers/login.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
    })
    .then(res => res.json())
    .then(data => {
        console.log("ðŸ”Ž Login Response:", data);
        if (data.status === "success") {
    localStorage.setItem("userData", JSON.stringify(data.user));
    window.location.href = data.redirect;
} else if (data.redirect) {
    // First time login
    localStorage.setItem("userData", JSON.stringify(data.user || {}));
    window.location.href = data.redirect;
} else {
    alert(data.message || "Login failed");
}

    })
    .catch(err => {
        console.error("Login error:", err);
        alert("Something went wrong. Please check the console.");
    });
});

    </script>
    <script src="../js/navbar-login-script.js"></script>
   

</body>

</html>
